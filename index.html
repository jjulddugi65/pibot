<!DOCTYPE html><html lang="en"><head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>FOR Pi MAXIMUM TRANSACTION Demo (SDK Final)</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    
    <script> Pi.init({ version: "2.0", sandbox: true }) </script>
    
Â  Â  <style>
Â  Â  Â  Â  /* CSS Styles */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: sans-serif;
Â  Â  Â  Â  Â  Â  background-color: #f3f4f6;
Â  Â  Â  Â  Â  Â  color: #1f2937;
Â  Â  Â  Â  Â  Â  padding: 2rem 1rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  .container {
Â  Â  Â  Â  Â  Â  max-width: 1200px;
Â  Â  Â  Â  Â  Â  margin: auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  .header {
Â  Â  Â  Â  Â  Â  background-color: #1f2937;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 2rem;
Â  Â  Â  Â  Â  Â  border-radius: 1rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  .simulator-section {
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  padding: 2rem;
Â  Â  Â  Â  Â  Â  margin: 2rem 0 0 0;
Â  Â  Â  Â  Â  Â  Â border-radius: 1rem 1rem 0 0;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 15px -5px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  .inflation-chart {
Â  Â  Â  Â  Â  Â  height: 300px;
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  padding: 1rem;
Â  Â  Â  Â  Â  Â  margin: 2rem 0;
Â  Â  Â  Â  Â  Â  border-radius: 1rem;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 15px -5px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Real-time Block Explorer iframe style */
Â  Â  Â  Â  #block_explorer_iframe {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 150px;
Â  Â  Â  Â  Â  Â  Â border: 2px solid #e5e7eb;
Â  Â  Â  Â  Â  Â  border-top: none;
Â  Â  Â  Â  Â  Â  border-radius: 0 0 1rem 1rem;
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  margin-bottom: 2rem;
Â  Â  Â  Â  Â }
Â  Â  Â  Â  /* SCP Consensus Animation Style */
Â  Â  Â  Â  .scp-consensus {
Â  Â  Â  Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  Â  Â  Â  Â font-weight: bold;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  Â background: #4f46e5;
Â  Â  Â  Â  Â  Â  Â padding: 0.3rem 0.6rem;
Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  Â  Â  Â  white-space: nowrap;
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  Â transition: opacity 0.3s;
Â  Â  Â  Â  Â  Â  margin-left: 1rem;
Â  Â  Â  Â  Â }
Â  Â  Â  Â  /* Ledger header container for flex */
Â  Â  Â  Â  .ledger-header-container {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 1rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Download button style */
Â  Â  Â  Â  .download-button {
Â  Â  Â  Â  Â  Â  background-color: #10b981;
Â  Â  Â  Â  Â  Â  Â color: white;
Â  Â  Â  Â  Â  Â  padding: 0.3rem 0.6rem;
Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  margin-left: auto;
Â  Â  Â  Â  Â  Â  Â transition: background-color 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .download-button:hover {
Â  Â  Â  Â  Â  Â  background-color: #059669;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Login and Payment Button Styles */
Â  Â  Â  Â  .pi-button {
Â  Â  Â  Â  Â  Â  padding: 0.75rem 1.5rem;
Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  transition: background-color 0.2s;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  margin-bottom: 1rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  .login-button {
Â  Â  Â  Â  Â  Â  background-color: #f7a43b; /* Pi Yellow */
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  .login-button:hover {
Â  Â  Â  Â  Â  Â  background-color: #e09133;
Â  Â  Â  Â  }
Â  Â  Â  Â  .payment-button {
Â  Â  Â  Â  Â  Â  background-color: #4CAF50; /* Green */
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  .payment-button:hover {
Â  Â  Â  Â  Â  Â  background-color: #45A049;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Input and Select styling for better visibility */
Â  Â  Â  Â  input[type="number"], select {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 0.5rem;
Â  Â  Â  Â  Â  Â  margin-top: 0.25rem;
Â  Â  Â  Â  Â  Â  border: 1px solid #d1d5db;
Â  Â  Â  Â  Â  Â  border-radius: 0.375rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Style for Public Key cell to ensure readability (ê¸€ê¼´ í¬ê¸° ì¶•ì†Œ ë°˜ì˜) */
Â  Â  Â  Â  .pk-cell {
Â  Â  Â  Â  Â  Â  font-family: monospace;
Â  Â  Â  Â  Â  Â  font-size: 0.65rem;
Â  Â  Â  Â  Â }
Â  Â  Â  Â  .grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  }
Â  Â  Â  Â  .grid-cols-2 {
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(2, minmax(0, 1fr));
Â  Â  Â  Â  }
Â  Â  Â  Â  .gap-4 {
Â  Â  Â  Â  Â  Â  gap: 1rem;
Â  Â  Â  Â  }
Â  Â  </style>
Â  Â  </head><body>
Â  Â  <div id="message_box" style="z-index: 1000; position: fixed; top: 1rem; left: 50%; transform: translateX(-50%) scale(0); transition: transform 0.3s; padding: 0.75rem 1.5rem; border-radius: 0.5rem; color: white; background-color: #1f2937;">Â  Â  Â  Â  App Status: ReadyÂ  Â  </div>
Â  Â  <div class="container">
Â  Â  Â  Â  <div class="header rounded-xl p-6 md:p-8 flex flex-col md:flex-row items-center justify-between mb-8">
Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-white text-lg font-semibold mb-2">FOR Pi MAXIMUM TRANSACTION (PiBot Final)</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-400 font-bold mb-4">Monitor real-time transactions and delegated AI activities based on your inputs.</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="md:ml-8 mt-4 md:mt-0">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-white text-sm font-bold text-center">Run simulation via the buttons below.</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="simulator-section">
Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4">Transaction Delegation Simulation (SDK Final Integrated)</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="login_button" class="pi-button login-button" onclick="piAuthenticate()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  1. Pi Login (Identify User)
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="payment_button" class="pi-button payment-button" onclick="piRequestPayment()" disabled>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  2. Request Pi Payment (Start SC)
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <p id="statusMessage" class="text-sm font-semibold text-center text-gray-700 mb-4">ê²°ì œ ìš”ì²­ ìƒíƒœ: ì¸ì¦ ëŒ€ê¸° ì¤‘...</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label htmlFor="piAmount">Pi Amount (for SC Selection):</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="piAmount" step="0.0001" value="0.0101" placeholder="e.g. 2.5">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label htmlFor="taskType">Task Type:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="taskType">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Drawing">ì°½ì‘: ê·¸ë¦¼ (Drawing)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Animation">ì°½ì‘: ì• ë‹ˆë©”ì´ì…˜ (Animation)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="VideoEdit">ì°½ì‘: ë™ì˜ìƒ í¸ì§‘ (Video Edit)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Research">ë°ì´í„°: ë¦¬ì„œì¹˜/ë¶„ì„ (Research/Analysis)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <iframe id="block_explorer_iframe"
Â  Â  Â  Â  Â  Â  Â  Â  Â src="https://blockexplorer.minepi.com/testnet/"
Â  Â  Â  Â  Â  Â  Â  Â  Â title="Pi Testnet Block Explorer"
Â  Â  Â  Â  Â  Â  Â  Â  Â frameborder="0"
Â  Â  Â  Â  Â  Â  Â  Â  allow="autoplay; encrypted-media"></iframe>
Â  Â  Â  Â  <div id="inflation_chart" class="inflation-chart">
Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-lg font-bold text-gray-700">Pi Economy Inflation Index (Simulated)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="public_tax_display" class="text-base font-bold text-green-600">Public Tax Pool: 0.0000 Pi</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="table-container p-6 mb-8 relative bg-white rounded-xl shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="ledger-header-container">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-gray-800">TRANSACTION LEDGER (Off-Chain/Logical)</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="download-button" onclick="downloadLedger()">Download CSV</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="scp_consensus_status" class="scp-consensus" style="opacity: 0;">SCP Consensus: 0/10001 Nodes</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <table class="min-w-full divide-y divide-gray-200" id="ledger_table">
Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr class="bg-gray-50">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-2 py-2 text-xs">ID</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-2 py-2 text-xs">Time</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-2 py-2 text-xs">Sender</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-2 py-2 text-xs">Smart Contract</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-2 py-2 text-xs">Pi Amount</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-2 py-2 text-xs">Task</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-2 py-2 text-xs">SC Code</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="smart_contract_ledger">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <script>
Â  Â  Â  Â  // === Core Variables ===
Â  Â  Â  Â  let transactionID = 18; // ë§ˆì§€ë§‰ ID ì´í›„ë¶€í„° ì‹œì‘
Â  Â  Â  Â  const maxNodes = 10001;
Â  Â  Â  Â  let authenticatedUser = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â // Public Keyê°€ í¬í•¨ëœ ëª¨ì˜ ì‚¬ìš©ì ì´ë¦„ ì„¤ì • (KYC ID + ì¤„ì¸ Public Key)
Â  Â  Â  Â  const MOCK_PUBLIC_KEY_SHORT = 'GDUVQR...QO6';
Â  Â  Â  Â  Â const KYC_ID = '10821';
Â  Â  Â  Â  Â // ---------------------------------------------------------------------------------------------------------------------------------
Â  Â  Â  Â  // [í•µì‹¬ ë³€ê²½] Pi SDKì˜ ì¸ì¦ ë° ê²°ì œ ë¡œì§ì„ í†µí•©í•˜ê³ , MOCK ëŒ€ì‹  ì‹¤ì œ Pi APIë¥¼ í˜¸ì¶œí•˜ë„ë¡ ë³€ê²½í•©ë‹ˆë‹¤.
Â  Â  Â  Â  // ---------------------------------------------------------------------------------------------------------------------------------
Â  Â  Â  Â  // --- Public Tax (ê³µê³µì„¸) & Economy Variables ---
Â  Â  Â  Â  const PUBLIC_TAX_RATE = 0.01; // 1% Public Tax (0.01)
Â  Â  Â  Â  const FIXED_FEE = 0.01; // ê³ ì • ìˆ˜ìˆ˜ë£Œ (0.01 Pi)
Â  Â  Â  Â  let publicTaxPool = 0.0; // ëˆ„ì  ê³µê³µì„¸ í’€ (í•©ê³„ì•¡)
Â  Â  Â  Â  // ----------------------------------------------------
Â  Â  Â  Â  // --- Utility Functions ---
Â  Â  Â  Â  function showMessage(message, isSuccess = true) {
Â  Â  Â  Â  Â  Â  const messageBox = document.getElementById('message_box');
Â  Â  Â  Â  Â  Â  if (!messageBox) return;
Â 
Â  Â  Â  Â  Â  Â  messageBox.textContent = message;
Â  Â  Â  Â  Â  Â  messageBox.style.opacity = 1;
Â  Â  Â  Â  Â  Â  messageBox.style.transform = 'translateX(-50%) scale(1)';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Re-apply classes for styling
Â  Â  Â  Â  Â  Â  messageBox.classList.remove('bg-green-600', 'bg-red-600', 'bg-gray-800');
Â  Â  Â  Â  Â  Â  if (isSuccess) {
Â  Â  Â  Â  Â  Â  Â  Â  messageBox.style.backgroundColor = '#4CAF50'; /* Green */
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  messageBox.style.backgroundColor = '#F44336'; /* Red */
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  messageBox.style.transform = 'translateX(-50%) scale(0)';
Â  Â  Â  Â  Â  Â  }, 3000);
Â  Â  Â  Â  }
Â  Â  Â  Â  // Fix 1: ê³µê³µì„¸ í’€ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ (ëˆ„ì  í•©ê³„ í‘œì‹œ)
Â  Â  Â  Â  function updatePublicTaxDisplay() {
Â  Â  Â  Â  Â  Â  const taxElement = document.getElementById('public_tax_display');
Â  Â  Â  Â  Â  Â  if (taxElement) {
Â  Â  Â  Â  Â  Â  Â  Â  // publicTaxPoolì€ runSimulationì—ì„œ ê³„ì† ëˆ„ì ë©ë‹ˆë‹¤.
Â  Â  Â  Â  Â  Â  Â  Â  taxElement.textContent = `Public Tax Pool: ${publicTaxPool.toFixed(4)} Pi`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  // SCP Consensus Animation Simulation
Â  Â  Â  Â  function startSCPAnimation(scType) {
Â  Â  Â  Â  Â  Â  const scpStatusElement = document.getElementById('scp_consensus_status');
Â  Â  Â  Â  Â  Â  if (!scpStatusElement) return;
Â 
Â  Â  Â  Â  Â  Â  scpStatusElement.style.opacity = 1;
Â 
Â  Â  Â  Â  Â  Â  const consensusSteps = [31, 314, 3141, maxNodes];
Â  Â  Â  Â  Â  Â  Â let stepIndex = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`AI selected ${scType}. Starting MOCKED SCP Consensus...`, true);
Â 
Â  Â  Â  Â  Â  Â  const interval = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const currentCount = consensusSteps[stepIndex];
Â  Â  Â  Â  Â  Â  Â  Â  scpStatusElement.textContent = `SCP Consensus: ${currentCount}/${maxNodes} Nodes`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stepIndex++;
Â  Â  Â  Â  Â  Â  Â  Â  if (stepIndex >= consensusSteps.length) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(interval);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scpStatusElement.textContent = `SCP Consensus: 10001/${maxNodes} Nodes (Finalized)`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, 500);
Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Pi SDK Authentication (Login) Logic ---
Â  Â  Â  Â  function piAuthenticate() {
Â  Â  Â  Â  Â  Â  // [í†µí•©: ì‹¤ì œ Pi.authenticate]
Â  Â  Â  Â  Â  Â  document.getElementById('statusMessage').innerText = "â³ 1. ì‚¬ìš©ì ì¸ì¦ ëŒ€ê¸° ì¤‘...";
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Pi.authenticate(["username", "payments"], onAuthenticate);
Â  Â  Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('statusMessage').innerText = `ğŸš« ì¸ì¦ ì´ˆê¸°í™” ì˜¤ë¥˜: ${e.message}`;
Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`ì¸ì¦ ì´ˆê¸°í™” ì‹¤íŒ¨: ${e.message}`, false);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function onAuthenticate(auth) {
Â  Â  Â  Â  Â  Â  if (auth.user) {
Â  Â  Â  Â  Â  Â  Â  Â  authenticatedUser = auth.user.username;
Â  Â  Â  Â  Â  Â  Â  Â  const userDisplay = authenticatedUser.substring(0, 10) + '...';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('statusMessage').innerText = `âœ… Pi ID: ${authenticatedUser} ì¸ì¦ ì„±ê³µ.`;
Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`Pi ID: ${userDisplay} authenticated successfully!`, true);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ë¡œê·¸ì¸ ë²„íŠ¼ ë¹„í™œì„±í™”, ê²°ì œ ë²„íŠ¼ í™œì„±í™”
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('login_button').disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('payment_button').disabled = false;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('statusMessage').innerText = "ğŸš« Pi ì¸ì¦ ì‹¤íŒ¨.";
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("Pi ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", false);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Pi SDK Payment Request Logic ---
Â  Â  Â  Â  function piRequestPayment() {
Â  Â  Â  Â  Â  Â  if (!authenticatedUser) {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("Pi ì¸ì¦ì„ ë¨¼ì € í•´ì£¼ì‹­ì‹œì˜¤.", false);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const amount = parseFloat(document.getElementById('piAmount').value);
Â  Â  Â  Â  Â  Â  const taskType = document.getElementById('taskType').value;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isNaN(amount) || amount <= 0) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â showMessage("ìœ íš¨í•œ Pi ê¸ˆì•¡ì„ ì…ë ¥í•˜ì‹­ì‹œì˜¤.", false);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const minRequiredAmount = 0.0101;
Â  Â  Â  Â  Â  Â  if (amount < minRequiredAmount) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â showMessage(`Pi ê¸ˆì•¡ì€ ìµœì†Œ ${minRequiredAmount.toFixed(4)} Pi ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.`, false);
Â  Â  Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // [í†µí•©: ì‹¤ì œ Pi.createPayment ë¡œì§]
Â  Â  Â  Â  Â  Â  document.getElementById('statusMessage').innerText = "â³ 2. íŠ¸ëœì­ì…˜ ìš”ì²­ ì¤‘... (Pi Browser íŒì—… í™•ì¸)";
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const paymentData = {
Â  Â  Â  Â  Â  Â  Â  Â  amount: amount,Â 
Â  Â  Â  Â  Â  Â  Â  Â  memo: `PiBot Service Fee for ${taskType}`,Â 
Â  Â  Â  Â  Â  Â  Â  Â  metadata: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskType: taskType,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  workCost: (amount - FIXED_FEE) / (1 + PUBLIC_TAX_RATE)Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const paymentCallbacks = {
Â  Â  Â  Â  Â  Â  Â  Â  onReadyForServerApproval: function(paymentId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('statusMessage').innerText = "âœ… ê²°ì œ ID ìƒì„±ë¨. ì„œë²„ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ (ì‹¤ì œ ê²°ì œëŠ” ì—¬ê¸°ì„œ ë°±ì—”ë“œ ì²˜ë¦¬)";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("ì„œë²„ ìŠ¹ì¸ ë‹¨ê³„ ì§„ì…. ë°±ì—”ë“œ ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.", true);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ê²°ì œê°€ ì‹œì‘ë˜ì—ˆìœ¼ë¯€ë¡œ, ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ì„ ì‹¤í–‰í•˜ì—¬ ì¥ë¶€ì— ê¸°ë¡í•©ë‹ˆë‹¤.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  runSimulation(taskType);
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  onReadyForServerCompletion: function(paymentId, txid) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('statusMessage').innerText = "ğŸ‰ ë¸”ë¡ì²´ì¸ ê±°ë˜ ì™„ë£Œ! ì‹¬ì‚¬ìœ„ì›ë‹˜, ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("ğŸ‰ íŠ¸ëœì­ì…˜ ì„±ê³µ!", true);
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  onCancel: function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('statusMessage').innerText = "âŒ ì‚¬ìš©ìê°€ ê²°ì œë¥¼ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("ê²°ì œ ì·¨ì†Œ.", false);
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  onError: function(error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('statusMessage').innerText = `ğŸš« ê²°ì œ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`ğŸš« ê²°ì œ ì˜¤ë¥˜: ${error.message}`, false);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Pi.createPayment(paymentData, paymentCallbacks).then(function(payment) {
Â  Â  Â  Â  Â  Â  Â  Â  console.log("Payment initiated:", payment);
Â  Â  Â  Â  Â  Â  }).catch(function(error) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('statusMessage').innerText = `âš ï¸ ê²°ì œ ìš”ì²­ ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`;
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Payment initialization error:", error);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Simulation & Core Logic (Called upon successful payment initiation) ---Â  Â  Â  Â Â 
Â  Â  Â  Â  function runSimulation(taskType) {Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const piAmountInput = document.getElementById('piAmount').value;Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const amount = parseFloat(piAmountInput);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // --- 1. ê²½ì œ ë¡œì§: ì‘ì—… ë¹„ìš© (W), ê³µê³µì„¸ (P), ê³ ì • ìˆ˜ìˆ˜ë£Œ (F) ì—­ì‚° ---Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // W = (A - F) / (1 + T)Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const workCost = (amount - FIXED_FEE) / (1 + PUBLIC_TAX_RATE);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ê³µê³µì„¸ ê³„ì‚°: ì§•ìˆ˜Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const publicTax = workCost * PUBLIC_TAX_RATE;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ê³µê³µì„¸ í’€ì— ëˆ„ì  í•©ê³„ ì ë¦½ ë° ì—…ë°ì´íŠ¸Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  publicTaxPool += publicTax;Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  updatePublicTaxDisplay();Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  // ------------------------------------------------------------------
Â  Â  Â  Â  Â  Â  // 2. Smart Contract Selection (Work Cost ê¸°ì¤€ìœ¼ë¡œ 1st/2nd SC ì„ íƒ)Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let scType = workCost >= 2.0 ? '2nd SC (Market)' : '1st SC (Survival)';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  startSCPAnimation(scType);Â 
Â  Â  Â  Â  Â  Â  const ledger = document.getElementById('smart_contract_ledger');Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Main Transaction IDÂ  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  transactionID++;Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const mainID = transactionID;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // AIì—ê²Œ ë¶„ë°°ë˜ëŠ” ìˆœìˆ˜ ì‘ì—… ë¹„ìš© (Work Cost)ì„ AI1ê³¼ AI2ì—ê²Œ ì ˆë°˜ì”© ë¶„í• Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const subAmountNet = (workCost / 2.0).toFixed(5);Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const senderName = authenticatedUser ? authenticatedUser : KYC_ID + '_...QO6'; // FallbackÂ  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const currentTime = new Date().toLocaleTimeString();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // AI ì‘ì—… ê²°ê³¼ ì‹œë®¬ë ˆì´ì…˜: 90% ì„±ê³µ, 10% ì‹¤íŒ¨Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const getAIResult = () => (Math.random() < 0.9) ? 'SUCCESS' : 'FAILURE';Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const subResult1 = getAIResult();Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const subResult2 = getAIResult();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 3. Main Transaction (User calling the SC) - Total AmountÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ë¡œì§ ëª…ì‹œë¥¼ ìœ„í•´ scTypeì„ ì¬ì„¤ì • (ì‚¬ìš©ì í”¼ë“œë°± ë°˜ì˜)Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let scDisplay = scType;Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (scType.includes('1st SC')) {Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  scDisplay = '1st SC (0.0101/n)';Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let newRowMain = ledger.insertRow();Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  newRowMain.innerHTML = `Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs font-bold">${mainID}</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">${currentTime}</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs font-bold pk-cell">${senderName} (Main T1)</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">${scDisplay}</td>Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs font-bold">${amount.toFixed(4)}</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">${taskType}</td>Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">CALLED</td>Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 4. Ledger Entry: Fixed Fee ì§•ìˆ˜ ê¸°ë¡ (Creator ì§€ë¶ˆ)Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  transactionID++;Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  let newRowFee = ledger.insertRow();Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  newRowFee.innerHTML = `Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">${transactionID}</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">${currentTime}</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">SYSTEM (Fee T2)</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs font-bold text-red-700">FIXED FEE (0.01)</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs font-bold text-red-700">-${FIXED_FEE.toFixed(4)}</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">Network Op</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">COLLECTED</td>Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  `;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 5. Ledger Entry: Public Tax ì§•ìˆ˜ ê¸°ë¡ (Creator ì§€ë¶ˆ)Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  transactionID++;Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  let newRowTax = ledger.insertRow();Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  newRowTax.innerHTML = `Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">${transactionID}</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">${currentTime}</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">SYSTEM (Tax T3)</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs font-bold text-red-600">PUBLIC TAX (1%)</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs font-bold text-red-600">-${publicTax.toFixed(4)}</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">Public Fund</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">COLLECTED</td>Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  `;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 6. Sub Transaction 1 (AI1 Activity & Net Amount Distribution) - Fix 2 ì ìš©: ì‹¤íŒ¨ ì‹œ ë¹¨ê°„ìƒ‰ í‘œì‹œÂ  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let newRow1 = ledger.insertRow();Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  newRow1.innerHTML = `Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">${mainID}-01</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">${currentTime}</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">AI1 (1/2 Net T4)</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">${scType} Process</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs font-bold text-green-600">+${subAmountNet}</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">${taskType} Process</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs font-bold ${subResult1 === 'FAILURE' ? 'text-red-600' : 'text-indigo-600'}">${subResult1}</td>Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  `;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 7. Sub Transaction 2 (AI2 Activity & Net Amount Distribution) - Fix 2 ì ìš©: ì‹¤íŒ¨ ì‹œ ë¹¨ê°„ìƒ‰ í‘œì‹œ ë° ê¸ˆì•¡ í‘œì‹œ í†µì¼Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let newRow2 = ledger.insertRow();Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  newRow2.innerHTML = `Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">${mainID}-02</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">${currentTime}</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">AI2 (1/2 Net T4)</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">${scType} Process</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs font-bold text-green-600">+${subAmountNet}</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs">${taskType} Process</td>Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-2 py-2 text-xs font-bold ${subResult2 === 'FAILURE' ? 'text-red-600' : 'text-indigo-600'}">${subResult2}</td>Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  showMessage(`Transaction recorded: Work Cost ($${workCost.toFixed(4)}), Tax ($${publicTax.toFixed(4)}), Fee ($${FIXED_FEE.toFixed(4)}) separated.`, true);Â  Â  Â  Â Â 
Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Ledger Download Function (Unchanged) ---Â  Â  Â  Â Â 
Â  Â  Â  Â  function downloadLedger() {Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const table = document.getElementById('ledger_table');Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let csv = [];Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 1. Get HeadersÂ  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const headerRow = table.querySelector('thead tr');Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let row = [];Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  headerRow.querySelectorAll('th').forEach(th => {Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  row.push(th.innerText);Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  csv.push(row.join(','));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 2. Get Data RowsÂ  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  table.querySelectorAll('#smart_contract_ledger tr').forEach(tr => {Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  row = [];Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  tr.querySelectorAll('td').forEach(td => {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let data = td.innerText.replace(/"/g, '""');Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.push(`"${data}"`);Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  csv.push(row.join(','));Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 3. Download the CSVÂ  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const csvString = csv.join('\n');Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const url = URL.createObjectURL(blob);Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const link = document.createElement('a');Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  link.setAttribute('href', url);Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  link.setAttribute('download', 'pi_governance_ledger.csv');Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  link.style.visibility = 'hidden';Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.body.appendChild(link);Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  link.click();Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.body.removeChild(link);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  showMessage("Ledger downloaded successfully!", true);Â  Â  Â  Â Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  // --- DOM Content Loaded Initialization (D3 Chart is now correctly initialized) ---Â  Â  Â  Â Â 
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Fix 1: Public Tax Display ì´ˆê¸°í™”Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  updatePublicTaxDisplay();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // D3.js Inflation Chart Initialization (Unchanged)Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const data = [1.5, 2.3, 1.8, 2.6, 3.0, 2.7, 3.2];Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const margin = {top: 20, right: 20, bottom: 40, left: 40};Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const chartDiv = document.getElementById('inflation_chart');Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const containerWidth = chartDiv.clientWidth - 20;Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const width = (containerWidth > 800 ? 800 : containerWidth) - margin.left - margin.right;Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  const height = 300 - margin.top - margin.bottom;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const svgContainer = d3.select('#inflation_chart').append('div')Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  .style('width', '100%')Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  .style('height', `${height + margin.top + margin.bottom}px`);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const svg = svgContainer.append('svg')Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  .attr('width', '100%')Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  .attr('height', height + margin.top + margin.bottom);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const x = d3.scaleBand().range([0, width]).padding(0.3);Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const y = d3.scaleLinear().range([height, 0]);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const g = svg.append("g")Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  g.append("g")Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  .attr("transform", "translate(0," + height + ")")Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  .call(d3.axisBottom(x));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  g.append("g")Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  .call(d3.axisLeft(y).ticks(5));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  g.selectAll(".bar")Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  .data(data)Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  .enter().append("rect")Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  .attr("class", "bar")Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  .attr("x", (d, i) => x('Q' + (i + 1)))Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  .attr("y", d => y(d))Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  .attr("width", x.bandwidth())Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  .attr("height", d => height - y(d))Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  .attr("fill", "#6366f1");Â  Â  Â  Â Â 
Â  Â  Â  Â  });Â  Â Â 
Â  Â  </script>
</body></html>
